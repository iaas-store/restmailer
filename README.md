# [RESTMAILER] Отправитель почты для WEB проектов

## Особенности
- REST-like API
- Поддержка подписи DKIM
- Поддержка SOCKS5 прокси для SMTP
- Возможность получить статус отправки
- Синхронный и асинхронный API
- Dockerfile в комплекте

Данный проект был сделан, чтобы заменить `msmtp` + `mail mta` для отправки почты с веб-проектов.
Он позволяет отправлять письма и получать статус отправки сразу на месте по HTTP-API (синхронный режим) или отдельным API запросом (асинхронный режим).

## Запуск
- Настройте PTR для IP сервера. Убедитесь, что она верно резолвится в обе стороны
- [Настройте SPF запись](https://help.mail.ru/developers/notes/spf/), указав IP сервера в разрешенных к отправке
- [Настройте TXT DKIM запись для домена](https://help.mail.ru/developers/notes/dkim/) - желательно
- Установите docker и склонируйте этот проект
- Скопируйте `.env.example` в `.env`, изменив настройки по требованиям
- Скопируйте `docker-compose.example.yaml` в `docker-compose.yaml`, изменив настройки по желанию
- Запустите `docker compose up`

## Использование
API находится в папке `./bruno`, для открытия коллекции испольйте [последнюю версию Bruno](https://github.com/usebruno/bruno/releases/)

### Авторизация
Укажите в `.env` в переменной `HTTP_AUTH_TOKENS` список токенов через запятую.

Передавайте один из них в заголовке `Authorization`.

### DKIM
Положите файл приватного ключа в папку `./data/dkim.key` и 
 добавите путь к файлу в `.env`: `MAIL_DKIM_KEY_PATH=/data/dkim.key`.

После включения в логе отправки вы должны видеть сообщение 
 `[mailer-dkim] sign generated, lenght=...`

### Сохранение состояния после перезапусков
Укажите в `.env` переменную `HTTP_RUNTIME_FILE_PATH=/data/runtime.json`.

В данном файле будут хранится идентификаторы отправок, письма и их состояния, максимальный размер файла 100 Мбайт

### SMTP прокси
Для включения прокси для SMTP-соединений укажите в `.env` переменную `MAIL_PROXY` в формате URL.

